<html lang="en">
  <head>
    <link rel="stylesheet" href="/styles.css" />
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>URL Shortener</title>
    <link rel="icon" href="/favicon.ico" />
  </head>

  <body>
    <div class="container">
      <div class="header-container">
        <svg>
          <text
            x="50.82863"
            y="20.12646"
            dy="309.717968"
            textAnchor="middle"
            id="text1"
            transform="scale(0.1225408,0.1839629)"
            style="
              font-size: 19.5rem;
              background-color: #333;
              stroke-width: 8.2185;
            "
          >
            <tspan x="100" y="100">SH_URL-T</tspan>
          </text>
        </svg>
        <!-- <h1>SH_URL-T</h1> -->
        <form action="/shorten" method="post">
          <label for="fullUrl">Enter URL to shorten:</label>
          <input type="url" name="fullUrl" id="fullUrl" required />
          <button type="submit">Shorten</button>
        </form>
        <button disabled id="myButton">Dark Mode</button>
      </div>
      <table>
        <% if (urls.loading ) { %>
        <div class="loader"></div>
        <% } %>
        <thead>
          <tr>
            <th>Full URL</th>
            <th>Short URL</th>
            <th># of Clicks</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% if (urls && urls.length >0) { %> <% urls.forEach(url => { %>
          <tr>
            <td>
              <a href="<%= url.full_url %>" target="_blank" class="full-url"
                ><%= url.full_url %></a
              >
            </td>

            <td class="short-url">
              <a href="<%= url.full_url %>" target="_blank"
                ><%= url.short_url %></a
              >
              <button class="copy-btn" data-url="<%= url.full_url %>">
                Co
              </button>
            </td>
            <td><%= url.clicks %></td>
            <td>
              <form method="post" action="/delete" class="buttontd">
                <button
                  name="shortUrl"
                  id="shortUrl"
                  type="submit"
                  value="<%= url.short_url %>"
                >
                  Delete
                </button>
              </form>
            </td>
          </tr>
          <% }); %> <% } else { %>
          <tr>
            <td colspan="3">No URLs found.</td>
          </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </body>
</html>
<script>
  const myButton = document.getElementById("myButton");

  let isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches;
  myButton.addEventListener("click", () => {
    if (isDarkMode) {
      document.body.classList.add("light-mode");
    } else {
      document.body.classList.add("dark-mode");
    }
  });

  const copyBtns = document.querySelectorAll(".copy-btn");

  copyBtns.forEach((btn) => {
    btn.addEventListener("click", () => {
      const url = btn.getAttribute("data-url");
      navigator.clipboard
        .writeText(url)
        .then(() => {
          alert(`Copied ${url} to clipboard`);
        })
        .catch((err) => {
          console.error("Error copying to clipboard:", err);
        });
    });
  });
</script>
